# Himatch（ヒマッチ） 要件定義書

**バージョン**: 1.0
**最終更新日**: 2026-02-20
**ステータス**: Phase 1 MVP 実装完了 / Phase 2 部分実装済み

---

## 1. プロダクト概要

### 1.1 プロダクト名
**Himatch（ヒマッチ）** — 友達の空き時間を自動マッチング＆文脈付き提案する予定調整アプリ

### 1.2 ビジョン
「いつ空いてる？」を聞くアプリではなく、「この日、こう遊べるよ！」と自動提案するアプリ。幹事の負担をゼロにし、予定を立てる楽しさを最大化する。

### 1.3 ターゲットユーザー
- **メインターゲット**: 18〜27歳の大学生・若手社会人
- **利用シーン**: シフト制バイト・不規則勤務の友人グループ（4〜8人）で月1〜4回の遊びの予定を立てる
- **プラットフォーム**: iOS（将来 Android 対応予定）

### 1.4 競合との差別化

| 機能 | Himatch | TimeTree | 調整さん | LINE スケジュール |
|------|---------|----------|---------|----------------|
| シフト/予定共有 | ○ | ◎ | × | △ |
| 空き時間自動検出 | ○ | × | × | × |
| **文脈付き提案** | **◎** | × | × | × |
| **天気連携提案** | **◎** | × | × | × |
| グループチャット・投票 | ○ | × | ◎ | ○ |
| 給料計算 | ○ | × | × | × |

---

## 2. ユーザーペルソナ

### ペルソナ A: 田中 美咲（22歳・大学4年生）
- カフェバイト週3〜4日。シフト制で毎週変動
- 大学の友達5〜6人グループで月2〜3回遊びたい
- **ペイン**: シフトをLINEに送るのが面倒、幹事負担が大きい、結局流れることが多い
- **期待**: シフトを入れたら自動共有。候補日を勝手に出してくれれば楽

### ペルソナ B: 鈴木 翔太（27歳・IT企業営業）
- 平日勤務だが残業時間がバラバラ
- 大学時代の友人8人で3ヶ月に1回集まりたい
- **ペイン**: 候補日を出す段階で面倒、2時間と8時間の空きが同列扱い
- **期待**: 「この日に飲みに行けるよ」と自動で教えてくれるアプリ

### ペルソナ C: 山本 あかり（19歳・大学1年生）
- コンビニバイト週2〜3日。シフトが毎週変わる
- 新しい友達やサークル仲間と週1ペースで遊びたい
- **ペイン**: まだ親しくない人に「いつ空いてる？」と聞きにくい
- **期待**: 予定を共有するだけで遊ぶきっかけができるアプリ

---

## 3. 機能要件

### 3.1 Phase 1: MVP（実装完了）

#### FR-01: 認証・アカウント管理
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-01-01 | Apple Sign In でアカウント作成・ログインできる | P0 | 実装済 |
| FR-01-02 | Google Sign In でアカウント作成・ログインできる | P0 | 実装済 |
| FR-01-03 | LINE Login でアカウント作成・ログインできる | P0 | 実装済 |
| FR-01-04 | デモモード（認証なし）で全機能を操作できる | P0 | 実装済 |
| FR-01-05 | 表示名・アバターの設定が可能 | P0 | 実装済 |
| FR-01-06 | ログアウト操作が可能 | P0 | 実装済 |

#### FR-02: カレンダー・スケジュール管理
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-02-01 | 月表示カレンダーで予定一覧を確認できる | P0 | 実装済 |
| FR-02-02 | 月⇔2週間の表示切替ができる | P1 | 実装済 |
| FR-02-03 | 日付タップで当日の予定をインラインに表示する | P0 | 実装済 |
| FR-02-04 | スケジュールの新規作成（タイトル・日時・種別・色）ができる | P0 | 実装済 |
| FR-02-05 | スケジュール種別: shift / event / free / blocked の4種別をサポート | P0 | 実装済 |
| FR-02-06 | 公開範囲設定: public / friends / private を選択できる | P1 | 実装済 |
| FR-02-07 | 繰り返し予定（DAILY / WEEKLY / MONTHLY / YEARLY）を設定できる | P1 | 実装済 |
| FR-02-08 | 予定テンプレートの保存・適用ができる | P1 | 実装済 |
| FR-02-09 | 祝祭日が赤色表示され、祝日名が表示される | P1 | 実装済 |
| FR-02-10 | 土曜日は青色、日曜日は赤色で日付番号が表示される | P1 | 実装済 |

#### FR-03: シフト管理
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-03-01 | シフトペイントモード: シフト種別を選択し、日付タップで連続入力できる | P0 | 実装済 |
| FR-03-02 | シフト種別（早番・遅番・夜勤等）をカスタマイズできる | P0 | 実装済 |
| FR-03-03 | シフトパターン（ローテーション）の保存・一括適用ができる | P1 | 実装済 |
| FR-03-04 | カレンダーセル内にシフトバッジ（色+略称）が表示される | P0 | 実装済 |
| FR-03-05 | シフトペイントパネルの開閉が可能で、完了ボタンで入力終了できる | P0 | 実装済 |

#### FR-04: グループ管理
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-04-01 | グループを新規作成できる（名前・説明・カラー） | P0 | 実装済 |
| FR-04-02 | 8桁英数字の招待コードが自動生成される | P0 | 実装済 |
| FR-04-03 | 招待コードを入力してグループに参加できる | P0 | 実装済 |
| FR-04-04 | グループにカラーを設定でき、後から変更できる（8色プリセット） | P1 | 実装済 |
| FR-04-05 | グループカードがグループカラーで着色表示される | P1 | 実装済 |
| FR-04-06 | グループからの退出ができる | P0 | 実装済 |
| FR-04-07 | グループ内メンバーのカレンダーを重ね合わせ表示できる | P0 | 実装済 |
| FR-04-08 | メンバーの空き度ヒートマップを表示できる | P1 | 実装済 |
| FR-04-09 | グループ詳細画面からチャット・投票・ToDo等各機能にアクセスできる | P0 | 実装済 |

#### FR-05: 文脈付き候補日提案
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-05-01 | グループ全員の空き時間を自動検出する（30分解像度） | P0 | 実装済 |
| FR-05-02 | 空き時間の長さ・時間帯に基づいて文脈ラベルを自動付与する | P0 | 実装済 |
| FR-05-03 | 5分類以上の文脈: 一日空き / 半日空き / 夜空き / ランチ空き / 朝空き | P0 | 実装済 |
| FR-05-04 | 各候補日にアクティビティ提案（ランチ・飲み会・日帰り旅行等）を表示する | P0 | 実装済 |
| FR-05-05 | 100点満点のスコアリング（参加率40・天気20・時間15・曜日15・直近10） | P0 | 実装済 |
| FR-05-06 | 候補日カレンダーにスコア色分けマーカーが表示される | P0 | 実装済 |
| FR-05-07 | 日付タップで候補詳細ボトムシートが開く | P0 | 実装済 |
| FR-05-08 | 候補タイルにグループカラーが適用され、どのグループの提案か判別できる | P1 | 実装済 |

#### FR-06: 投票・確定フロー
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-06-01 | 候補日に対して OK / 微妙 / NG の3択で投票できる | P0 | 実装済 |
| FR-06-02 | 同じボタンを再タップすると投票を解除できる（トグル動作） | P1 | 実装済 |
| FR-06-03 | リアルタイムで投票状況が全員に表示される | P0 | 実装済 |
| FR-06-04 | グループオーナーが候補日を最終確定できる | P0 | 実装済 |
| FR-06-05 | 確定した予定にカレンダーに自動追加される | P0 | 実装済 |
| FR-06-06 | 公開投票画面で全グループ横断の投票が可能 | P1 | 実装済 |

#### FR-07: お誘い・共有
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-07-01 | 候補日から「お誘いを送る」ことができる | P0 | 実装済 |
| FR-07-02 | お誘い送信先: グループチャット / アンケート作成 / 外部共有（LINE等）を選択できる | P0 | 実装済 |
| FR-07-03 | シェアカード（SNS向け画像）を生成できる | P1 | 実装済 |

#### FR-08: グループ内チャット
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-08-01 | テキストメッセージの送受信ができる | P0 | 実装済 |
| FR-08-02 | 未読メッセージ件数がバッジ表示される | P0 | 実装済 |
| FR-08-03 | メッセージに送信者名・送信日時が表示される | P0 | 実装済 |

#### FR-09: グループ内投票（アンケート）
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-09-01 | 質問と選択肢（複数）のアンケートを作成できる | P0 | 実装済 |
| FR-09-02 | 匿名投票をサポートする | P1 | 実装済 |
| FR-09-03 | 投票結果がリアルタイムで反映される | P0 | 実装済 |
| FR-09-04 | 未投票のアンケート件数がバッジ表示される | P1 | 実装済 |

#### FR-10: グループ内 ToDo
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-10-01 | タスクの作成・完了チェックができる | P0 | 実装済 |
| FR-10-02 | 担当者のアサインができる | P1 | 実装済 |
| FR-10-03 | 期限の設定ができる | P1 | 実装済 |
| FR-10-04 | 未完了タスク件数がバッジ表示される | P1 | 実装済 |

#### FR-11: グループ内アルバム
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-11-01 | 写真をグリッド表示で閲覧できる | P0 | 実装済 |
| FR-11-02 | キャプション付きで写真を投稿できる | P1 | 実装済 |

#### FR-12: グループ掲示板
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-12-01 | テキスト投稿の作成・閲覧ができる | P0 | 実装済 |

#### FR-13: 割り勘・経費管理
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-13-01 | 支出を記録できる（金額・内容・支払者・カテゴリ） | P0 | 実装済 |
| FR-13-02 | 均等分割 / カスタム分割に対応する | P1 | 実装済 |
| FR-13-03 | 精算画面で「誰が誰にいくら払うか」を計算・表示する | P0 | 実装済 |

#### FR-14: 給料計算
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-14-01 | 勤務先情報（名前・時給・交通費）を登録できる | P0 | 実装済 |
| FR-14-02 | シフト実績から月間給料を自動計算する（時給×時間+交通費） | P0 | 実装済 |
| FR-14-03 | 税壁警告（103万・130万・150万の壁）を表示する | P1 | 実装済 |
| FR-14-04 | 複数の勤務先に対応する | P1 | 実装済 |

#### FR-15: プロフィール・設定
| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-15-01 | テーマカラー（6色プリセット）を選択できる | P1 | 実装済 |
| FR-15-02 | ライト/ダーク/システム準拠のモード切替ができる | P1 | 実装済 |
| FR-15-03 | 通知設定（カテゴリ別 ON/OFF）ができる | P1 | 実装済 |
| FR-15-04 | 利用規約・プライバシーポリシー・お問い合わせへのリンクがある | P1 | 実装済 |

### 3.2 Phase 2: 早期追加機能（部分実装済み）

| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-20-01 | 天気予報連携: 候補日に天気情報（アイコン・気温・降水確率）を表示する | P0 | 実装済 |
| FR-20-02 | 天気に応じたアクティビティ提案（雨→映画、晴れ→BBQ等）を行う | P0 | 実装済 |
| FR-20-03 | 天気予報の地域を GPS 現在地またはを都市名検索で設定できる | P0 | 実装済 |
| FR-20-04 | GPS 現在地モードのトグル ON/OFF ができる | P0 | 実装済 |
| FR-20-05 | カレンダーアプリ連携（Apple / Google Calendar インポート） | P0 | 設計済 |
| FR-20-06 | リマインダー通知（前日・当日） | P1 | 設計済 |
| FR-20-07 | アクティビティフィード（グループ内のイベントタイムライン） | P1 | 実装済 |

### 3.3 Phase 3: 将来機能

| ID | 要件 | 優先度 | 状態 |
|----|------|--------|------|
| FR-30-01 | AI 高度提案（過去の行動パターン学習） | P1 | 未着手 |
| FR-30-02 | 場所提案（中間地点・おすすめスポット） | P1 | 未着手 |
| FR-30-03 | Android 版（Flutter コードベース再利用） | P1 | 未着手 |
| FR-30-04 | SNS 共有（Instagram Stories 等） | P2 | 未着手 |
| FR-30-05 | iOS ホームスクリーンウィジェット | P1 | 未着手 |
| FR-30-06 | スタンプ・リアクション | P2 | 未着手 |
| FR-30-07 | 外部サービス連携（ホットペッパー・食べログ等） | P2 | 未着手 |

---

## 4. 非機能要件

### 4.1 パフォーマンス

| ID | 要件 | 基準値 |
|----|------|--------|
| NFR-01 | アプリ起動時間 | 2秒以内（コールドスタート） |
| NFR-02 | 画面遷移のレスポンス | 300ms 以内 |
| NFR-03 | 候補日提案の計算時間 | 1秒以内（10人グループ・30日分） |
| NFR-04 | API レスポンス時間 | 500ms 以内（P95） |
| NFR-05 | カレンダースクロール | 60fps 維持 |

### 4.2 可用性・信頼性

| ID | 要件 | 基準値 |
|----|------|--------|
| NFR-06 | サービス稼働率 | 99.5% 以上 |
| NFR-07 | オフライン利用 | ローカルキャッシュで基本操作可能 |
| NFR-08 | データ同期 | オンライン復帰時に自動同期 |

### 4.3 セキュリティ

| ID | 要件 |
|----|------|
| NFR-09 | 通信は全て TLS 1.3 で暗号化 |
| NFR-10 | パスワードは Supabase Auth で管理（アプリ側に平文保存しない） |
| NFR-11 | Row Level Security (RLS) により他ユーザーのデータへのアクセスを防止 |
| NFR-12 | JWT トークンの有効期限管理とリフレッシュ機構 |
| NFR-13 | 個人情報の取り扱いは個人情報保護法に準拠 |

### 4.4 拡張性

| ID | 要件 |
|----|------|
| NFR-14 | DAU 数千人規模まで Supabase Pro ($25/月) で対応可能 |
| NFR-15 | Flutter コードベースにより将来の Android 展開が容易 |
| NFR-16 | Freezed + Riverpod による型安全な状態管理で機能追加が容易 |

### 4.5 ユーザビリティ

| ID | 要件 |
|----|------|
| NFR-17 | 初回登録は3タップ以内で完了 |
| NFR-18 | シフト入力は1日あたり2タップ以内で完了（ペイントモード） |
| NFR-19 | iOS Human Interface Guidelines に準拠 |
| NFR-20 | ダークモード対応 |
| NFR-21 | 日本語 UI 完全対応 |

---

## 5. ユーザーストーリー

### US-01: ユーザー登録
> **田中美咲として**、Apple ID で ワンタップ登録したい。**なぜなら**、新しくアカウントを作る手間があると友達を誘いにくいから。

**受入基準**: Apple / Google / LINE でアカウント作成可能。登録完了まで3タップ以内。

### US-02: シフト入力
> **田中美咲として**、カレンダー上でタップするだけでシフトを入力したい。**なぜなら**、毎週変わるバイトのシフトを素早く登録して友達と共有したいから。

**受入基準**: シフト種別を選択 → 日付を連続タップで一括登録。セル内にバッジ表示。

### US-03: グループ作成・招待
> **鈴木翔太として**、グループを作成して招待コードを送りたい。**なぜなら**、LINEで招待リンクを送れれば参加ハードルが下がるから。

**受入基準**: グループ名・説明・色を設定して作成。8桁招待コードを共有可能。

### US-04: 文脈付き候補日提案
> **田中美咲として**、「この日は飲み会向き」「この日は日帰り旅行できる」と教えてほしい。**なぜなら**、空いている日が分かっても「何する？」が決まらないと結局流れてしまうから。

**受入基準**: 空き時間の長さ・時間帯・天気に基づいて文脈ラベルとアクティビティを自動提案。

### US-05: 投票・確定
> **鈴木翔太として**、提案された候補日にメンバーが投票して多数決で決めたい。**なぜなら**、幹事として全員にメッセージを送る手間を省きたいから。

**受入基準**: OK / 微妙 / NG の3択投票。トグルで解除可能。オーナーが確定ボタンで最終決定。

### US-06: 給料計算
> **山本あかりとして**、今月のバイト代を自動で計算してほしい。**なぜなら**、シフト入力済みの情報から給料を計算できれば管理が楽だから。

**受入基準**: 時給×勤務時間+交通費の自動計算。税壁警告あり。

---

## 6. KPI 定義

### 6.1 ノーススターメトリック
**「週あたりの確定予定数」（Weekly Confirmed Plans）**

目標: リリース3ヶ月後に週200件の予定確定

### 6.2 ユーザーアクティビティ指標

| KPI | 定義 | 3ヶ月後目標 |
|-----|------|------------|
| DAU | 1日にアプリを開いたユニークユーザー数 | 500 |
| WAU | 1週間にアプリを開いたユニークユーザー数 | 2,000 |
| MAU | 1ヶ月にアプリを開いたユニークユーザー数 | 5,000 |
| DAU/MAU 比率 | スティッキネス | 10% 以上 |

### 6.3 リテンション指標

| KPI | 目標 | 業界平均 |
|-----|------|---------|
| Day1 リテンション | 40% | 25-30% |
| Day7 リテンション | 25% | 12-15% |
| Day30 リテンション | 15% | 6-8% |

### 6.4 コア機能利用指標

| KPI | 目標 |
|-----|------|
| グループ作成数/ユーザー | 1.5 以上 |
| グループ平均メンバー数 | 4人以上 |
| 予定入力率 | 登録ユーザーの70% |
| 提案→投票率 | 50% |
| 提案→確定率 | 20% |
| 招待成功率 | 30% |

---

## 7. リスクと軽減策

| リスク | 影響度 | 軽減策 |
|--------|--------|--------|
| ユーザーが予定を入力しない | 高 | シフトペイントモードで入力を極限まで簡略化。カレンダー連携（Phase 2）で自動取り込み |
| グループへの招待が広がらない | 高 | 2人から使える設計。招待フローを最適化 |
| 文脈提案の精度が低い | 中 | 5パターンのシンプルなルールベースで開始。ユーザーフィードバックで改善 |
| プライバシー懸念 | 中 | グループ単位の共有に限定。公開範囲設定で制御 |
| TimeTree が AI 提案機能を先行リリース | 高 | MVP を最速リリースし先行者優位を確保 |

---

## 8. 制約事項

| 制約 | 詳細 |
|------|------|
| プラットフォーム | Phase 1 は iOS のみ（Flutter により Android 対応は容易） |
| 言語 | UI は日本語のみ（初回リリース） |
| グループ上限 | 1グループあたり最大20人 |
| 天気予報精度 | 3〜5日先までが高精度。7日以上先は参考値 |
| オフライン | 閲覧は可能だが、投票・チャット送信はオンライン必須 |
